<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>License Verification</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
      color: #222;
    }
    .status {
      padding: 12px 16px;
      border-radius: 6px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .valid { background: #d4f8d4; color: #0a7a0a; }
    .expired { background: #ffe0e0; color: #a30000; }
    .grace { background: #fff4cc; color: #8a6d00; }
    .invalid { background: #f2f2f2; color: #555; }
    code {
      background: #f4f4f4;
      padding: 3px 6px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <h1>License Verification</h1>
  <p id="loading">Checking license…</p>
  <div id="result"></div>

  <script>
    (async function () {
      const params = new URLSearchParams(window.location.search);
      const licenseKey = params.get("licenseKey");

      const resultEl = document.getElementById("result");
      const loadingEl = document.getElementById("loading");

      if (!licenseKey) {
        loadingEl.textContent = "No license key provided.";
        return;
      }

      try {
        const response = await fetch("https://gist.githubusercontent.com/erickouassi/e6bdb0c49657bd73659c46b602573331/raw/2cbb6504ba4206ccdda4612dfcf8f572699f5e18/ytubestats.data.json", {
          cache: "no-store"
        });
        const data = await response.json();

        const license = data.licenses.find(item => item.key === licenseKey);

        if (!license) {
          loadingEl.remove();
          resultEl.innerHTML = `
            <div class="status invalid">INVALID LICENSE KEY</div>
            <p>The key <code>${licenseKey}</code> does not exist in our system.</p>
          `;
          return;
        }

        // Determine status
        let statusHTML = "";
        const today = new Date();

        if (license.expires === "never") {
          statusHTML = `<div class="status valid">VALID — Lifetime License</div>`;
        } else {
          const expires = new Date(license.expires);

          if (today <= expires) {
            statusHTML = `<div class="status valid">VALID — Active License</div>`;
          } else {
            const graceEnd = new Date(expires);
            graceEnd.setDate(graceEnd.getDate() + license.graceDays);

            if (today <= graceEnd) {
              statusHTML = `<div class="status grace">EXPIRED — In Grace Period</div>`;
            } else {
              statusHTML = `<div class="status expired">EXPIRED — No Longer Valid</div>`;
            }
          }
        }

        loadingEl.remove();

        resultEl.innerHTML = `
          ${statusHTML}

          <h2>License Details</h2>
          <p><strong>License Key:</strong> <code>${license.key}</code></p>
          <p><strong>Type:</strong> ${license.type}</p>
          <p><strong>Activated:</strong> ${license.activated}</p>
          <p><strong>Expires:</strong> ${license.expires}</p>
          <p><strong>Grace Period:</strong> ${license.graceDays} days</p>
          <p><strong>Max Domains:</strong> ${license.maxDomains}</p>

          <h3>Approved Domains</h3>
          <ul>
            ${license.domains.map(d => `<li>${d}</li>`).join("")}
          </ul>
        `;
      } catch (err) {
        loadingEl.textContent = "Error loading license data.";
        console.error(err);
      }
    })();
  </script>

</body>
</html>
